name: Repository nue page build

inputs:
  root:
    default: '.'
    type: string
  archive:
    default: ''
    type: string

runs:
  using: composite
  steps:
    - uses: oven-sh/setup-bun@v2

    - name: Install and link nue
      shell: bash
      run: |
        bun install
        cd packages/nuekit/
        bun link

    - name: Build Nue Project
      shell: bash
      run: nue build -pr "${{ inputs.root }}"

    # archive generated site, remove leading "./" from file paths in archive
    - name: Archive files
      if: ${{ inputs.archive }}
      shell: bash
      run: tar -C "${{ inputs.root }}.dist/prod" --transform "s/^\.\///" -czf "${{ inputs.archive }}" .
